dist: bionic
language: python
python:
- 3.9
# blocklist branches
branches:
  except:
  - requires-io-master
  - /^dependabot.*$/
addons:
  apt:
    packages:
      - postgresql-13
      - postgresql-client-13
  homebrew:
    packages:
      - postgresql@13
      - postgresql@12
      - postgresql@11
      - postgresql@10
      - postgresql@9.6
      - postgresql@9.5

install:
- pip install -r requirements-test.txt
- pip install coveralls wheel
script:
- POSTGRES=13 py.test -n 0
jobs:
  include:
    - stage: osx
      language: generic
      os: osx
      osx_image: xcode12.2
      before_install:
      - pip3 install virtualenv
      - virtualenv venv -p python3
      - source venv/bin/activate
      script:
      - POSTGRES=9.5 py.test -n 0
      - POSTGRES=9.6 py.test -n 0
      - POSTGRES=10 py.test -n 0
      - POSTGRES=11 py.test -n 0
      - POSTGRES=12 py.test -n 0
      - POSTGRES=13 py.test -n 0
